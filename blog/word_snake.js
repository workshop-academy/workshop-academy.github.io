const WORD_DATA={nouns:["apple","astronaut","adventure","bicycle","butterfly","castle","dragon","unicorn","pirate","robot","candy","icecream","rainbow","superhero","dinosaur","fairy","wizard","goblin","monster","pizza","cake","bubble","sparkle","rocket","spaceship","teddy","balloon","jellybean","marshmallow","sundae","eagle","elephant","engine","hammer","house","hippo","kite","kangaroo","key","lion","lamp","leaf","nest","needle","newt","oak","orange","otter","quartz","queen","quail","vase","violin","vulture","xylophone","xenon","xray","yak","yacht","yogurt","zebra","zoo","zeppelin","dolphin","fox","frog","giraffe","goat","iguana","island","jaguar","journal","mountain","panda","rabbit","tiger","turtle","umbrella","urchin","whale","wolf"],verbs:["amuse","arrange","admire","bounce","build","bark","climb","crawl","create","dance","discover","dream","explore","giggle","glide","gallop","imagine","invest","inspect","juggle","jump","jog","laugh","listen","march","move","melt","nibble","paint","play","push","sing","skip","zoom","fly","flick","float","sprint","spin","twirl","elevate","examine","exclaim","hurry","hum","hunt","kick","knead","know","lean","lurk","navigate","nudge","nurse","observe","obtain","offer","question","quench","quiet","venture","vibrate","visualize","run","roll","reach","tap","tumble","talk","use","unite","upgrade","whisper","wander","wave","xerox","xray","xylophonize","yell","yawn","yearn","zap","zigzag","zest"],adjectives:["amazing","brave","bright","calm","curious","dazzling","eager","fancy","glittery","happy","sparkly","fluffy","fuzzy","magical","mysterious","playful","quick","quiet","radiant","silly","smart","sparkling","splendid","strong","tiny","vibrant","windy","wonderful","zany","elegant","energetic","enigmatic","humble","hasty","hearty","keen","kind","kooky","lively","lazy","luminous","nervous","nice","noisy","odd","optimistic","obscure","quirky","vivid","vast","vigilant","xenial","xenophobic","xylophonic","young","yellow","youthful","zealous","zesty","zippy","awesome","angelic","agile","bold","charming","delightful","determined","graceful","gloomy","intelligent","inquisitive","intense","jolly","joyful","judicious","mellow","peaceful","proud","quaint","quixotic","robust","reliable","tough","tranquil","unique","upright","ultra","wise","witty"],connectors:["and","then","because","so","meanwhile","suddenly","however","after","before"],phrases:["a surprising twist","a tiny mystery","a friendly helper","the plot thickens","new clues appear","the adventure continues","a magical surprise","the hero triumphs"]};class SimpleAI{constructor(t,e=.8){this.repo=t,this.temperature=Math.max(.05,Math.min(e,2)),this.used=new Set,this.rareLetters=new Set(["q","z","x","w","j","k"])}_candidates(t){const e=t.toLowerCase();return this.repo.allWords().filter(t=>t.toLowerCase().startsWith(e))}_score(t){const e=t.toLowerCase();return.8+(this.used.has(e)?.2:1)+(this.repo.categories.adjectives.includes(t)?.2:0)+(this.repo.categories.verbs.includes(t)?.15:0)+(this.rareLetters.has(t[t.length-1].toLowerCase())?.25:0)}getReasoning(t){const e=t[t.length-1],i=this._candidates(e),s=i.map(t=>({word:t,score:this._score(t)})).sort((t,e)=>e.score-t.score).slice(0,5);return{lastLetter:e,candidatesCount:i.length,topCandidates:s}}}class WordRepo{constructor(t){this.categories=t}allWords(){return[...this.categories.adjectives,...this.categories.nouns,...this.categories.verbs]}connectors(){return this.categories.connectors}phrases(){return this.categories.phrases}}class GluttonousSnakeGame{constructor(t){this.container=document.getElementById(t),this.cellSize=20,this.cols=30,this.rows=30,this.width=this.cols*this.cellSize,this.height=this.rows*this.cellSize,this.speed=200,this.timeLimit=60,this.score=0,this.timeLeft=this.timeLimit,this.intervalId=null,this.demoIntervalId=null,this.isDemo=!1,this.gameOver=!1,this.demoEatenCount=0,this.repo=new WordRepo(WORD_DATA),this.ai=new SimpleAI(this.repo),this.prevProbs=null,this.direction={x:1,y:0},this.pendingDirection=null,this.snake=[{x:Math.floor(this.cols/2),y:Math.floor(this.rows/2)}],this.candidates=[],this.chain=[],this.createUI(),this.bindEvents()}createUI(){this.container.innerHTML="",this.container.style.display="flex",this.container.style.flexDirection="row";const t=document.createElement("div");t.style.flex="1";const e=document.createElement("div");e.style.marginBottom="10px",this.scoreEl=document.createElement("span"),this.scoreEl.textContent="Score: 0",this.timerEl=document.createElement("span"),this.timerEl.style.marginLeft="20px",this.timerEl.textContent="Time: 20s",e.appendChild(this.scoreEl),e.appendChild(this.timerEl),t.appendChild(e);const i=document.createElement("div");i.className="game-wrapper",i.style.display="flex",i.style.alignItems="flex-start",this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.border="1px solid #333",this.canvas.style.width="50%",this.canvas.style.maxWidth=`${this.width}px`,this.canvas.style.height="50%",this.ctx=this.canvas.getContext("2d"),i.appendChild(this.canvas),this.adjustCanvasSize(),window.addEventListener("resize",()=>{this.adjustCanvasSize(),this.placeCandidates(),this.draw()}),this.candidatePanel=document.createElement("div"),this.candidatePanel.style.marginLeft="10px",this.candidatePanel.style.maxHeight="200px",this.candidatePanel.style.overflowY="auto",this.candidatePanel.style.border="1px solid #ccc",this.candidatePanel.style.padding="5px",this.candidatePanel.style.fontFamily="monospace",i.appendChild(this.candidatePanel),t.appendChild(i),this.explanationArea=document.createElement("div"),this.explanationArea.style.marginTop="10px",this.explanationArea.style.fontFamily="Arial, sans-serif",this.explanationArea.style.whiteSpace="pre-wrap",t.appendChild(this.explanationArea),this.aiInfo=document.createElement("div"),this.aiInfo.style.marginTop="10px",this.aiInfo.style.whiteSpace="pre-wrap",this.aiInfo.style.fontFamily="monospace",t.appendChild(this.aiInfo),this.scoreBulletin=document.createElement("div"),this.scoreBulletin.style.marginTop="10px",this.scoreBulletin.style.fontFamily="Arial, sans-serif",this.scoreBulletin.style.whiteSpace="pre-wrap",this.scoreBulletin.textContent="\ud83d\udd22 How the AI scores words: It gives each word a raw score, then applies a softmax (turns scores into percentages) so the highest\u2011scoring word is most likely to be chosen. This helps the AI pick the next token like picking the most popular candy in a jar!",this.sentenceArea=document.createElement("div"),this.sentenceArea.style.marginTop="10px",this.sentenceArea.style.fontFamily="Arial, sans-serif",this.sentenceArea.style.whiteSpace="pre-wrap",t.appendChild(this.sentenceArea),this.startBtn=document.createElement("button"),this.startBtn.textContent="Start Game",this.startBtn.style.display="block",this.startBtn.style.marginTop="10px",t.appendChild(this.startBtn),this.demoBtn=document.createElement("button"),this.demoBtn.textContent="Demo Mode",this.demoBtn.style.display="block",this.demoBtn.style.marginTop="10px",t.appendChild(this.demoBtn),this.container.appendChild(t)}bindEvents(){document.addEventListener("keydown",t=>{const e=t.key;"ArrowUp"===e&&1!==this.direction.y?this.pendingDirection={x:0,y:-1}:"ArrowDown"===e&&-1!==this.direction.y?this.pendingDirection={x:0,y:1}:"ArrowLeft"===e&&1!==this.direction.x?this.pendingDirection={x:-1,y:0}:"ArrowRight"===e&&-1!==this.direction.x&&(this.pendingDirection={x:1,y:0})}),this.startBtn.addEventListener("click",()=>this.start()),this.demoBtn.addEventListener("click",()=>this.startDemo())}adjustCanvasSize(){const t=this.container.clientWidth,e=t<500?250:500,i=Math.min(t,e),s=Math.max(10,Math.floor(i/Math.max(this.cols,this.rows)));this.cellSize=s,this.width=this.cols*this.cellSize,this.height=this.rows*this.cellSize,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width="100%",this.canvas.style.maxWidth=`${this.width}px`,this.canvas.style.height="auto"}start(){this.reset(),this.placeCandidates(),this.startBtn.disabled=!0,this.intervalId=setInterval(()=>this.gameLoop(),this.speed),this.timerId=setInterval(()=>this.updateTimer(),1e3)}startDemo(){this.isDemo=!0,this.reset(),this.placeCandidates(),this.startBtn.disabled=!0,this.demoBtn.disabled=!0,this.demoEatenCount=0,this.demoIntervalId=setInterval(()=>this.demoLoop(),this.speed)}demoLoop(){if(this.chain.length>=10)return void this.endDemo();const t=this.snake[0];if(0===this.candidates.length)return void this.placeCandidates();let e=null;for(const t of this.candidates)(!e||t.score>e.score)&&(e=t);e&&(t.x<e.x&&t.x+1<this.cols?this.direction={x:1,y:0}:t.x>e.x&&t.x-1>=0?this.direction={x:-1,y:0}:t.y<e.y&&t.y+1<this.rows?this.direction={x:0,y:1}:t.y>e.y&&t.y-1>=0&&(this.direction={x:0,y:-1})),this.gameLoop()}endDemo(){clearInterval(this.demoIntervalId),this.startBtn.disabled=!1,this.demoBtn.disabled=!1,this.aiInfo.textContent+="\nDemo finished after eating 10 words!";const t=this._storyFromChain(this.chain);this.storyArea&&(this.storyArea.textContent=t);const e='\ud83e\udd16 <b>GenAI Explanation</b>\n\ud83d\udd24 <b>Next word prediction</b>: The AI looks at the last letter (the "context") and picks a word that fits.\n\ud83e\udde0 <b>How LLMs write</b>: They learned from many stories, so they can guess the next word like a game of word\u2011snake.\n\u26a0\ufe0f <b>Limits</b>: The AI doesn\u2019t really understand; it can make silly mistakes and only knows what it has read.\n\ud83d\udd22 <b>How the AI scores words</b>: It gives each word a raw score, then applies a softmax (turns scores into percentages) so the highest\u2011scoring word is most likely to be chosen. This helps the AI pick the next token like picking the most popular candy in a jar!\n';this.explanationArea&&(this.explanationArea.innerHTML=e),this.gameOver=!0}reset(){this.gameOver=!1,this.score=0,this.timeLeft=this.timeLimit,this.direction={x:1,y:0},this.pendingDirection=null,this.snake=[{x:Math.floor(this.cols/2),y:Math.floor(this.rows/2)}],this.candidates=[],this.ai.used.clear(),this.updateScore(),this.updateTimerDisplay(),this.aiInfo.textContent="",this.chain=[],this.storyArea&&(this.storyArea.textContent=""),this.candidatePanel&&(this.candidatePanel.innerHTML=""),this.sentenceArea&&(this.sentenceArea.textContent=""),this.explanationArea&&(this.explanationArea.textContent="")}updateTimer(){this.timeLeft--,this.updateTimerDisplay(),this.timeLeft<=0&&!this.gameOver&&this.endGame()}updateTimerDisplay(){this.timerEl.textContent=`Time: ${this.timeLeft}s`}updateScore(){this.scoreEl.textContent=`Score: ${this.score}`}placeCandidates(){let t=[];for(let e=0;e<this.rows;e++)for(let i=0;i<this.cols;i++)this.snake.some(t=>t.x===i&&t.y===e)||t.push({x:i,y:e});if(0===t.length)return;let e=[];if(this.chain.length>0){const t=this.chain[this.chain.length-1],i=t[t.length-1].toLowerCase(),s=this.repo.allWords().filter(t=>t.toLowerCase().startsWith(i));e=(s.length>0?s:this.repo.allWords()).map(t=>({word:t,score:this.ai._score(t)}))}else{e=this.repo.allWords().map(t=>({word:t,score:this.ai._score(t)}))}e.sort((t,e)=>e.score-t.score);const i=e.slice(0,5),s=t.sort(()=>Math.random()-.5);this.candidates=[];for(const{word:t,score:e}of i){this.ctx.font=this.cellSize-2+"px Arial";for(let i=0;i<s.length;i++){const n=s[i],a=this.ctx.measureText(t).width,o=n.x*this.cellSize+this.cellSize/2-a/2;if(o>=0&&o+a<=this.width){this.candidates.push({x:n.x,y:n.y,word:t,score:e}),s.splice(i,1);break}}}if(0===this.candidates.length&&i.length>0&&s.length>0){const t=s[0],{word:e,score:n}=i[0];this.ctx.font=this.cellSize-2+"px Arial";const a=this.ctx.measureText(e).width,o=t.x*this.cellSize+this.cellSize/2-a/2;o>=0&&o+a<=this.width&&this.candidates.push({x:t.x,y:t.y,word:e,score:n})}}gameLoop(){this.pendingDirection&&(this.direction=this.pendingDirection,this.pendingDirection=null);const t=this.snake[0],e={x:t.x+this.direction.x,y:t.y+this.direction.y};if(e.x<0||e.x>=this.cols||e.y<0||e.y>=this.rows)return void(this.gameOver||this.endGame());if(this.snake.some(t=>t.x===e.x&&t.y===e.y))return void(this.gameOver||this.endGame());this.snake.unshift(e);let i=null;for(let t=0;t<this.candidates.length;t++){const s=this.candidates[t];if(e.x===s.x&&e.y===s.y){i=s,this.candidates.splice(t,1);break}}if(i){this.score++,this.updateScore(),this.chain.push(i.word),this.ai.used.add(i.word.toLowerCase());const t=this.ai.getReasoning(i.word);this.lastChosenScore=i.score,this.showAIInfo(i.word,t),this.placeCandidates()}else this.snake.pop();this.draw()}draw(){this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="#4caf50";for(const t of this.snake)this.ctx.fillRect(t.x*this.cellSize,t.y*this.cellSize,this.cellSize,this.cellSize);if(this.candidates&&this.candidates.length){this.ctx.fillStyle="#d32f2f",this.ctx.font=this.cellSize-2+"px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle";for(const t of this.candidates)this.ctx.fillText(t.word,t.x*this.cellSize+this.cellSize/2,t.y*this.cellSize+this.cellSize/2)}}showAIInfo(t,e){if(this.gameOver)return;let i;if(this.chain.length>1){const t=this.chain[this.chain.length-2];i=t[t.length-1].toLowerCase()}else i=t[0].toLowerCase();const s=this.ai._candidates(i),n=s.map(t=>({word:t,score:this.ai._score(t)}));n.sort((t,e)=>e.score-t.score);const a=n.slice(0,5),o=void 0!==this.lastChosenScore?this.lastChosenScore:this.ai._score(t);let r=`You ate: ${t}\n`;if(r+=`AI step \u2013 last letter '${i}' \u2192 candidates: ${s.length}\n`,a.length>0){const t=a.map(t=>`${t.word}:${t.score.toFixed(2)}`).join(", ");r+=`Top ${a.length} scores: ${t}\n`}r+="The AI treats the last letter as the context token, generates candidate words, scores them using novelty, adjective/verb bonuses, and a rare\u2011letter boost.",this.aiInfo.textContent=r;const h=document.createElement("div");h.style.borderBottom="1px solid #eee",h.style.padding="2px 0",h.textContent=`Chosen: ${t} (score:${o.toFixed(2)}); Candidates: ${a.map(t=>`${t.word}:${t.score.toFixed(2)}`).join(", ")}`,this.candidatePanel.appendChild(h),this.sentenceArea&&(this.sentenceArea.textContent=this._storyFromChain(this.chain))}_storyFromChain(t){const e=this.repo.connectors(),i=[],s=t.filter(t=>this.repo.categories.nouns.includes(t)),n=t.filter(t=>this.repo.categories.verbs.includes(t)),a=t.filter(t=>this.repo.categories.adjectives.includes(t)),o=Math.max(s.length,n.length,a.length);for(let t=0;t<o;t++)if(t<s.length&&i.push(s[t]),t<n.length&&i.push(n[t]),t<a.length&&i.push(a[t]),t<o-1&&e.length){e[Math.floor(Math.random()*e.length)]}i.length&&(i[0]=i[0].charAt(0).toUpperCase()+i[0].slice(1));let r=i.join(" ");return/[.!?]$/.test(r)||(r+="."),r}endGame(){if(this.gameOver)return;this.gameOver=!0,clearInterval(this.intervalId),clearInterval(this.timerId),this.startBtn.disabled=!1,this.aiInfo.textContent+=`\nGame over! Final score: ${this.score}`;const t=this._storyFromChain(this.chain);this.storyArea&&(this.storyArea.textContent=t);const e='\ud83e\udd16 <b>GenAI Explanation</b>\n\ud83d\udd24 <b>Next word prediction</b>: The AI looks at the last letter (the "context") and picks a word that fits.\n\ud83e\udde0 <b>How LLMs write</b>: They learned from many stories, so they can guess the next word like a game of word\u2011snake.\n\u26a0\ufe0f <b>Limits</b>: The AI doesn\u2019t really understand; it can make silly mistakes and only knows what it has read.\n\ud83d\udd22 <b>How the AI scores words</b>: It gives each word a raw score, then applies a softmax (turns scores into percentages) so the highest\u2011scoring word is most likely to be chosen. This helps the AI pick the next token like picking the most popular candy in a jar!\n';this.explanationArea&&(this.explanationArea.innerHTML=e)}}window.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("gluttonous-snake-container");t||(t=document.createElement("div"),t.id="gluttonous-snake-container",document.body.appendChild(t)),new GluttonousSnakeGame("gluttonous-snake-container")});