const WORD_DATA={nouns:["apple","astronaut","adventure","bicycle","butterfly","castle","dragon","unicorn","pirate","robot","candy","icecream","rainbow","superhero","dinosaur","fairy","wizard","goblin","monster","pizza","cake","bubble","sparkle","rocket","spaceship","teddy","balloon","jellybean","marshmallow","sundae","eagle","elephant","engine","hammer","house","hippo","kite","kangaroo","key","lion","lamp","leaf","nest","needle","newt","oak","orange","otter","quartz","queen","quail","vase","violin","vulture","xylophone","xenon","xray","yak","yacht","yogurt","zebra","zoo","zeppelin","dolphin","fox","frog","giraffe","goat","iguana","island","jaguar","journal","mountain","panda","rabbit","tiger","turtle","umbrella","urchin","whale","wolf","coconut","cupcake","flamingo","firetruck","monkey","sunflower","squirrel","banana","bubbles","candycorn","doughnut","eclair","fuzzybear","gigglegoblin","hippopotamus","icecreamcone","jellyfish","koala","lemonade","nachos","octopus","pancake","quokka","spaghetti","taco","velociraptor","watermelon","yoyo","zucchini"],verbs:["amuse","arrange","admire","bounce","build","bark","climb","crawl","create","dance","discover","dream","explore","giggle","glide","gallop","imagine","invest","inspect","juggle","jump","jog","laugh","listen","march","move","melt","nibble","paint","play","push","sing","skip","zoom","fly","flick","float","sprint","spin","twirl","elevate","examine","exclaim","hurry","hum","hunt","kick","knead","know","lean","lurk","navigate","nudge","nurse","observe","obtain","offer","question","quench","quiet","venture","vibrate","visualize","run","roll","reach","tap","tumble","talk","use","unite","upgrade","whisper","wander","wave","xerox","xray","xylophonize","yell","yawn","yearn","zap","zigzag","zest"],adjectives:["amazing","brave","bright","calm","curious","dazzling","eager","fancy","glittery","happy","sparkly","fluffy","fuzzy","magical","mysterious","playful","quick","quiet","radiant","silly","smart","sparkling","splendid","strong","tiny","vibrant","windy","wonderful","zany","elegant","energetic","enigmatic","humble","hasty","hearty","keen","kind","kooky","lively","lazy","luminous","nervous","nice","noisy","odd","optimistic","obscure","quirky","vivid","vast","vigilant","xenial","xenophobic","xylophonic","young","yellow","youthful","zealous","zesty","zippy","awesome","angelic","agile","bold","charming","delightful","determined","graceful","gloomy","intelligent","inquisitive","intense","jolly","joyful","judicious","mellow","peaceful","proud","quaint","quixotic","robust","reliable","tough","tranquil","unique","upright","ultra","wise","witty"],connectors:["and","then","because","so","meanwhile","suddenly","however","after","before"],phrases:["a surprising twist","a tiny mystery","a friendly helper","the plot thickens","new clues appear","the adventure continues","a magical surprise","the hero triumphs"]};class SimpleAI{constructor(e,t=.8){this.repo=e,this.temperature=Math.max(.05,Math.min(t,2)),this.used=new Set,this.rareLetters=new Set(["q","z","x","w","j","k"])}_candidates(e){const t=e.toLowerCase();return this.repo.allWords().filter(e=>e.toLowerCase().startsWith(t))}_score(e){const t=e.toLowerCase();return.8+(this.used.has(t)?.2:1)+(this.repo.categories.adjectives.includes(e)?.2:0)+(this.repo.categories.verbs.includes(e)?.15:0)+(this.rareLetters.has(e[e.length-1].toLowerCase())?.25:0)}getReasoning(e){const t=e[e.length-1],i=this._candidates(t),s=i.map(e=>({word:e,score:this._score(e)})).sort((e,t)=>t.score-e.score).slice(0,5);return{lastLetter:t,candidatesCount:i.length,topCandidates:s}}}class WordRepo{constructor(e){this.categories=e}allWords(){return[...this.categories.adjectives,...this.categories.nouns,...this.categories.verbs]}connectors(){return this.categories.connectors}phrases(){return this.categories.phrases}}class GluttonousSnakeGame{constructor(e){this.container=document.getElementById(e),this.cellSize=20,this.cols=30,this.rows=30,this.width=this.cols*this.cellSize,this.height=this.rows*this.cellSize,this.speed=200,this.timeLimit=60,this.score=0,this.timeLeft=this.timeLimit,this.intervalId=null,this.demoIntervalId=null,this.isDemo=!1,this.gameOver=!1,this.demoEatenCount=0,this.repo=new WordRepo(WORD_DATA),this.ai=new SimpleAI(this.repo),this.prevProbs=null,this.direction={x:1,y:0},this.pendingDirection=null,this.snake=[{x:Math.floor(this.cols/2),y:Math.floor(this.rows/2)}],this.candidates=[],this.chain=[],this.createUI(),this.bindEvents()}createUI(){this.container.innerHTML="",this.container.style.display="flex",this.container.style.flexDirection="row";const e=document.createElement("div");e.style.flex="1";const t=document.createElement("div");t.style.marginBottom="10px",this.scoreEl=document.createElement("span"),this.scoreEl.textContent="Score: 0",this.timerEl=document.createElement("span"),this.timerEl.style.marginLeft="20px",this.timerEl.textContent="Time: 20s",t.appendChild(this.scoreEl),t.appendChild(this.timerEl),e.appendChild(t);const i=document.createElement("div");i.className="game-wrapper",i.style.display="flex",i.style.alignItems="flex-start",this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.border="1px solid #333",this.canvas.style.width="50%",this.canvas.style.maxWidth=`${this.width}px`,this.canvas.style.height="50%",this.ctx=this.canvas.getContext("2d"),i.appendChild(this.canvas),this.adjustCanvasSize(),window.addEventListener("resize",()=>{this.adjustCanvasSize(),this.placeCandidates(),this.draw()}),this.candidatePanel=document.createElement("div"),this.candidatePanel.style.marginLeft="10px",this.candidatePanel.style.maxHeight="200px",this.candidatePanel.style.overflowY="auto",this.candidatePanel.style.border="1px solid #ccc",this.candidatePanel.style.padding="5px",this.candidatePanel.style.fontFamily="monospace",i.appendChild(this.candidatePanel),e.appendChild(i),this.explanationArea=document.createElement("div"),this.explanationArea.style.marginTop="10px",this.explanationArea.style.fontFamily="Arial, sans-serif",this.explanationArea.style.whiteSpace="pre-wrap",e.appendChild(this.explanationArea),this.aiInfo=document.createElement("div"),this.aiInfo.style.marginTop="10px",this.aiInfo.style.whiteSpace="pre-wrap",this.aiInfo.style.fontFamily="monospace",e.appendChild(this.aiInfo),this.scoreBulletin=document.createElement("div"),this.scoreBulletin.style.marginTop="10px",this.scoreBulletin.style.fontFamily="Arial, sans-serif",this.scoreBulletin.style.whiteSpace="pre-wrap",this.scoreBulletin.textContent="\ud83d\udd22 How the AI scores words: It gives each word a raw score, then applies a softmax (turns scores into percentages) so the highest\u2011scoring word is most likely to be chosen. This helps the AI pick the next token like picking the most popular candy in a jar!",this.sentenceArea=document.createElement("div"),this.sentenceArea.style.marginTop="10px",this.sentenceArea.style.fontFamily="Arial, sans-serif",this.sentenceArea.style.whiteSpace="pre-wrap",e.appendChild(this.sentenceArea),this.startBtn=document.createElement("button"),this.startBtn.textContent="Start Game",this.startBtn.style.display="block",this.startBtn.style.marginTop="10px",e.appendChild(this.startBtn),this.demoBtn=document.createElement("button"),this.demoBtn.textContent="Demo Mode",this.demoBtn.style.display="block",this.demoBtn.style.marginTop="10px",e.appendChild(this.demoBtn),this.container.appendChild(e)}bindEvents(){document.addEventListener("keydown",e=>{const t=e.key;"ArrowUp"===t&&1!==this.direction.y?this.pendingDirection={x:0,y:-1}:"ArrowDown"===t&&-1!==this.direction.y?this.pendingDirection={x:0,y:1}:"ArrowLeft"===t&&1!==this.direction.x?this.pendingDirection={x:-1,y:0}:"ArrowRight"===t&&-1!==this.direction.x&&(this.pendingDirection={x:1,y:0})}),this.startBtn.addEventListener("click",()=>this.start()),this.demoBtn.addEventListener("click",()=>this.startDemo())}adjustCanvasSize(){const e=this.container.clientWidth,t=e<500?250:500,i=Math.min(e,t),s=Math.max(10,Math.floor(i/Math.max(this.cols,this.rows)));this.cellSize=s,this.width=this.cols*this.cellSize,this.height=this.rows*this.cellSize,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width="100%",this.canvas.style.maxWidth=`${this.width}px`,this.canvas.style.height="auto"}start(){this.reset(),this.placeCandidates(),this.startBtn.disabled=!0,this.intervalId=setInterval(()=>this.gameLoop(),this.speed),this.timerId=setInterval(()=>this.updateTimer(),1e3)}startDemo(){this.isDemo=!0,this.reset(),this.placeCandidates(),this.startBtn.disabled=!0,this.demoBtn.disabled=!0,this.demoEatenCount=0,this.demoIntervalId=setInterval(()=>this.demoLoop(),this.speed)}demoLoop(){if(this.chain.length>=10)return void this.endDemo();const e=this.snake[0];if(0===this.candidates.length)return void this.placeCandidates();let t=null;for(const e of this.candidates)(!t||e.score>t.score)&&(t=e);t&&(e.x<t.x&&e.x+1<this.cols?this.direction={x:1,y:0}:e.x>t.x&&e.x-1>=0?this.direction={x:-1,y:0}:e.y<t.y&&e.y+1<this.rows?this.direction={x:0,y:1}:e.y>t.y&&e.y-1>=0&&(this.direction={x:0,y:-1})),this.gameLoop()}endDemo(){clearInterval(this.demoIntervalId),this.startBtn.disabled=!1,this.demoBtn.disabled=!1,this.aiInfo.textContent+="\nDemo finished after eating 10 words!";const e=this._storyFromChain(this.chain);this.storyArea&&(this.storyArea.textContent=e);const t='\ud83e\udd16 <b>GenAI Explanation</b>\n\ud83d\udd24 <b>Next word prediction</b>: The AI looks at the last letter (the "context") and picks a word that fits.\n\ud83e\udde0 <b>How LLMs write</b>: They learned from many stories, so they can guess the next word like a game of word\u2011snake.\n\u26a0\ufe0f <b>Limits</b>: The AI doesn\u2019t really understand; it can make silly mistakes and only knows what it has read.\n\ud83d\udd22 <b>How the AI scores words</b>: It gives each word a raw score, then applies a softmax (turns scores into percentages) so the highest\u2011scoring word is most likely to be chosen. This helps the AI pick the next token like picking the most popular candy in a jar!\n';this.explanationArea&&(this.explanationArea.innerHTML=t),this.gameOver=!0}reset(){this.gameOver=!1,this.score=0,this.timeLeft=this.timeLimit,this.direction={x:1,y:0},this.pendingDirection=null,this.snake=[{x:Math.floor(this.cols/2),y:Math.floor(this.rows/2)}],this.candidates=[],this.ai.used.clear(),this.updateScore(),this.updateTimerDisplay(),this.aiInfo.textContent="",this.chain=[],this.storyArea&&(this.storyArea.textContent=""),this.candidatePanel&&(this.candidatePanel.innerHTML=""),this.sentenceArea&&(this.sentenceArea.textContent=""),this.explanationArea&&(this.explanationArea.textContent="")}updateTimer(){this.timeLeft--,this.updateTimerDisplay(),this.timeLeft<=0&&!this.gameOver&&this.endGame()}updateTimerDisplay(){this.timerEl.textContent=`Time: ${this.timeLeft}s`}updateScore(){this.scoreEl.textContent=`Score: ${this.score}`}placeCandidates(){const e=[];for(let t=0;t<this.rows;t++)for(let i=0;i<this.cols;i++)this.snake.some(e=>e.x===i&&e.y===t)||e.push({x:i,y:t});if(0===e.length)return;const t=["nouns","verbs","adjectives","connectors"],i=t[this.chain.length%t.length];let s;s="connectors"===i?this.repo.connectors():"phrases"===i?this.repo.phrases():this.repo.categories[i];let n=[];if("connectors"===i||"phrases"===i)n=s.map(e=>({word:e,score:this.ai._score(e)}));else if(this.chain.length>0){const e=this.chain[this.chain.length-1],t=e[e.length-1].toLowerCase(),i=s.filter(e=>e.toLowerCase().startsWith(t));n=(i.length>0?i:s).map(e=>({word:e,score:this.ai._score(e)}))}else n=s.map(e=>({word:e,score:this.ai._score(e)}));n.sort((e,t)=>t.score-e.score);const a=n.slice(0,5),o=e.sort(()=>Math.random()-.5);this.candidates=[];for(const{word:e,score:t}of a){this.ctx.font=this.cellSize-2+"px Arial";for(let i=0;i<o.length;i++){const s=o[i],n=this.ctx.measureText(e).width,a=s.x*this.cellSize+this.cellSize/2-n/2;if(a>=0&&a+n<=this.width){this.candidates.push({x:s.x,y:s.y,word:e,score:t}),o.splice(i,1);break}}}if(0===this.candidates.length&&a.length>0&&o.length>0){const e=o[0],{word:t,score:i}=a[0];this.ctx.font=this.cellSize-2+"px Arial";const s=this.ctx.measureText(t).width,n=e.x*this.cellSize+this.cellSize/2-s/2;n>=0&&n+s<=this.width&&this.candidates.push({x:e.x,y:e.y,word:t,score:i})}}gameLoop(){this.pendingDirection&&(this.direction=this.pendingDirection,this.pendingDirection=null);const e=this.snake[0],t={x:e.x+this.direction.x,y:e.y+this.direction.y};if(t.x<0||t.x>=this.cols||t.y<0||t.y>=this.rows)return void(this.gameOver||this.endGame());if(this.snake.some(e=>e.x===t.x&&e.y===t.y))return void(this.gameOver||this.endGame());this.snake.unshift(t);let i=null;for(let e=0;e<this.candidates.length;e++){const s=this.candidates[e];if(t.x===s.x&&t.y===s.y){i=s,this.candidates.splice(e,1);break}}if(i){this.score++,this.updateScore(),this.chain.push(i.word),this.ai.used.add(i.word.toLowerCase());const e=this.ai.getReasoning(i.word);this.lastChosenScore=i.score,this.showAIInfo(i.word,e),this.placeCandidates()}else this.snake.pop();this.draw()}draw(){this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="#4caf50";for(const e of this.snake)this.ctx.fillRect(e.x*this.cellSize,e.y*this.cellSize,this.cellSize,this.cellSize);if(this.candidates&&this.candidates.length){this.ctx.fillStyle="#d32f2f",this.ctx.font=this.cellSize-2+"px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle";for(const e of this.candidates)this.ctx.fillText(e.word,e.x*this.cellSize+this.cellSize/2,e.y*this.cellSize+this.cellSize/2)}}showAIInfo(e,t){if(this.gameOver)return;let i;if(this.chain.length>1){const e=this.chain[this.chain.length-2];i=e[e.length-1].toLowerCase()}else i=e[0].toLowerCase();const s=this.ai._candidates(i),n=s.map(e=>({word:e,score:this.ai._score(e)}));n.sort((e,t)=>t.score-e.score);const a=n.slice(0,5),o=void 0!==this.lastChosenScore?this.lastChosenScore:this.ai._score(e);let r=`You ate: ${e}\n`;if(r+=`AI step \u2013 last letter '${i}' \u2192 candidates: ${s.length}\n`,a.length>0){const e=a.map(e=>`${e.word}:${e.score.toFixed(2)}`).join(", ");r+=`Top ${a.length} scores: ${e}\n`}r+="The AI treats the last letter as the context token, generates candidate words, scores them using novelty, adjective/verb bonuses, and a rare\u2011letter boost.",this.aiInfo.textContent=r;const h=document.createElement("div");h.style.borderBottom="1px solid #eee",h.style.padding="2px 0",h.textContent=`Chosen: ${e} (score:${o.toFixed(2)}); Candidates: ${a.map(e=>`${e.word}:${e.score.toFixed(2)}`).join(", ")}`,this.candidatePanel.appendChild(h),this.sentenceArea&&(this.sentenceArea.textContent=this._storyFromChain(this.chain))}_storyFromChain(e){if(!e||0===e.length)return"";const t=e[0];let i=[t.charAt(0).toUpperCase()+t.slice(1),...e.slice(1)].join(" ");return/[.!?]$/.test(i)||(i+="."),i}endGame(){if(this.gameOver)return;this.gameOver=!0,clearInterval(this.intervalId),clearInterval(this.timerId),this.startBtn.disabled=!1,this.aiInfo.textContent+=`\nGame over! Final score: ${this.score}`;const e=this._storyFromChain(this.chain);this.storyArea&&(this.storyArea.textContent=e);const t='\ud83e\udd16 <b>GenAI Explanation</b>\n\ud83d\udd24 <b>Next word prediction</b>: The AI looks at the last letter (the "context") and picks a word that fits.\n\ud83e\udde0 <b>How LLMs write</b>: They learned from many stories, so they can guess the next word like a game of word\u2011snake.\n\u26a0\ufe0f <b>Limits</b>: The AI doesn\u2019t really understand; it can make silly mistakes and only knows what it has read.\n\ud83d\udd22 <b>How the AI scores words</b>: It gives each word a raw score, then applies a softmax (turns scores into percentages) so the highest\u2011scoring word is most likely to be chosen. This helps the AI pick the next token like picking the most popular candy in a jar!\n';this.explanationArea&&(this.explanationArea.innerHTML=t)}}window.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("gluttonous-snake-container");e||(e=document.createElement("div"),e.id="gluttonous-snake-container",document.body.appendChild(e)),new GluttonousSnakeGame("gluttonous-snake-container")});